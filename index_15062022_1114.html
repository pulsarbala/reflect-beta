<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Pulsar Bluetooth Remote Access</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
	<!-- <link rel="stylesheet" href="css/style-lr2.css"> -->
  <noscript>
    <link rel="stylesheet" href="css/skel-noscript.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/style-desktop.css" />
</noscript>  
  <link rel="stylesheet" href="css/style-lr.css">

  <style>
    .my_text
    {
      /* font-size: 44px; */
  font-family: Arial, sans-serif; 
   /* text-align: center;  */
  /* justify-content: center; */
   /* color: #ffffff; */
        /* font-family:    Arial, Helvetica, sans-serif; */
        font-size:      40px;
        font-weight:    bold;
        /* border: 1px solid #FFFF00; */
        width: 83%;
        padding: 5px 10px;
    }
    /* .center {
      border: 5px solid #FFFF00;
      padding: 50px 0;
    } */
</style>

<script>
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
</script>

<script>
    var sysState=0; // 0- Trace on state, 
    var c_state=0;
    var inboundChar;
    var outboundChar;
    var device;
    var isIgnore=0;
    var isIgnore_2=0;
    
    // Define the CodeLess UUIDs 
    var CODELESS_SVC_UUID 	= "866d3b04-e674-40dc-9c05-b7f91bec6e83";
    var INBOUND_CHAR_UUID 	= "914f8fb9-e8cd-411d-b7d1-14594de45425";
    var OUTBOUND_CHAR_UUID 	= "3bb535aa-50b2-4fbe-aa09-6b06dc59a404";
    var CNTRL_CHAR_UUID		= "e2048b39-d4f9-4a45-9f25-1856c10d5639";
  
    let options = {
        filters: [
        {name: 'PULS'},
        {name: 'PULS-BT'},
        {name: 'CLv2'},					
        {name: 'ABCa'},
        {name: 'ABC1'},
        {name: 'PMBT'},
		{name: 'ABC1'},
		{name: 'PULSARBT'},
		{name: 'PULSAR-BT'},
		{name: 'CodeLess'},		
        {name: 'Example1'},
        {name: 'Example2'},
        {name: 'Example3'},
        {name: 'Example4'},
        {name: 'Example5'},
        {name: 'Example6'},
        {name: 'Example7'},
        {name: 'Example8'},
        {name: 'Example9'},
        {name: 'CodeLess'},        
        {services: [CODELESS_SVC_UUID]}
        ],
        optionalServices: [CODELESS_SVC_UUID]
    }
  
    // Global variables
    var button_press = 0;
    var isTraceOn = 0;
    var level_var, distance_var, volume_var, compensated_var, compensated_var_m, mA_output_var, temperature_var, date_var, time_var, gate_start, gate_stop, echo_var, noise_var, status_var, near_blanking_var, far_blanking_var, empty_distance, mode_var, bit0, bit1, bit2, bit3, bit4, bit5, bit6, bit7;
    var p104_units_val, p605_units_val, p104_units, p605_units, p104_rx_status, p605_rx_status;
    level_var = 0.000;//4.346;
    distance_var = 0.000;//1.654;
    volume_var = 0.000;//2.370;
    compensated_var = 7.2;
    compensated_var_m = 7.2;
    mA_output_var = 0.000;//20.000;
    temperature_var = 0.000;//20.000;
    date_var = 190100.000;
    time_var = 2210.000;
    gate_start = 0;//202;
    gate_stop = 0;//258;
    echo_var = 0;//45;
    noise_var = 0;//30;
    status_var = 999;
    near_blanking_var = 0.3;
    far_blanking_var = 20.0;//6.0;
    far_blanking_dist = 7.2;
    empty_distance = 6.0;
    mode_var = 6.0;
    p104_units_val = 1;
    p605_units_val = 3;
    p104_units = "m";
    p605_units = "m³";
    p104_rx_status = 0;
    p605_rx_status = 0;

    // set interval
    var echo_tid;
    var datem_tid;
    var p104_tid;
    var p605_tid;
    var param_tid;
    var param_query=0;
    var isDisconnecting=0;
    var isTerminated=0;

    var login_stage = 0;    // Login status

    // Function to select the volume units to be displayed depending on p605 value
    function p605_volume_units() {
      switch(p605_units_val) {
        default:
          p605_units = "m³";
          break;
        case 1:
          p605_units = "Tons";
          break;
        case 2:
          p605_units = "Tonnes";
          break;
        case 3:
          p605_units = "m³";
          break;
        case 4:
          p605_units = "Litres";
          break;
        case 5:
          p605_units = "UK Gal";
          break;
        case 6:
          p605_units = "US Gal";
          break;
        case 7:
          p605_units = "ft³";
          break;
        case 8:
          p605_units = "Barrels";
          break;                                                                   
      }
    }

    // Function to select the measurement units to be displayed depending on p104 value
    function p104_measurement_units() {
      switch(p104_units_val) {
        default:
        case 1:
          p104_units = "m";
          break;
        case 2:
          p104_units = "cm";
          break;
        case 3:
          p104_units = "mm";
          break;
        case 4:
          p104_units = "ft";
          break;
        case 5:
          p104_units = "ins";
          break;          
      }
    }

    function convert_to_measurement_units(val_to_convert) {
      switch(p104_units_val) {
        default:
        case 1:
          break;
        case 2:
          val_to_convert *= 100.0;
          break;
        case 3:
          val_to_convert *= 1000.0;
          break;
        case 4:
          val_to_convert *= 3.28084;
          break;
        case 5:
          val_to_convert *= 39.3701;
          break;          
      }
      return val_to_convert;
    }

    function convert_to_mtrs(val_to_convert) {
      switch(p104_units_val) {
        default:
        case 1:
          break;
        case 2:
          val_to_convert /= 100.0;
          break;
        case 3:
          val_to_convert /= 1000.0;
          break;
        case 4:
          val_to_convert /= 3.28084;
          break;
        case 5:
          val_to_convert /= 39.3701;
          break;          
      }
      return val_to_convert;      
    }

    function settings_clear() {
      document.getElementById("p100-box").value = "";
      document.getElementById("p104-box").value = "";
      document.getElementById("p105-box").value = "";
      document.getElementById("p106-box").value = "";
      document.getElementById("p808-box").value = "";
      document.getElementById("p605-box").value = "";
      document.getElementById("p21-box").value = "";
    }

    function param_update() {
      if((login_stage >= 3) && (isDisconnecting == 0)) {
        tids_trace_reset();
        // settings_clear();
        param_query = 0;
        param_tid = setInterval(param_start, 1000);
      }
    }

    function param_start() {
      if((login_stage >= 3) && (isDisconnecting == 0)) {
        switch (param_query) {
          case 0:
            button_press = 20;
            sendAT('/P100');
            break;
          case 1:
            button_press = 21;
            sendAT('/P104');
            break;
          case 2:
            button_press = 22;
            sendAT('/P105');
            break;
          case 3:
            button_press = 23;
            sendAT('/P106');
            break;
          case 4:
            button_press = 24;
            sendAT('/P808');
            break;
          case 5:
            button_press = 25;
            sendAT('/P605');
            break;
          case 6:
            button_press = 26;
            sendAT('/P21');
            break;
          case 7:
            button_press = 0;
            clearTimeout(param_tid);
            break;
        }
      }
    }

    function echo_start() {
    // do some stuff...
    // no need to recall the function (it's an interval, it'll loop forever)
    if(login_stage == 4) { // TRACE ON state
        clearTimeout(echo_tid);
        clearTimeout(p104_tid);
        clearTimeout(p605_tid);
        clearTimeout(param_tid);  
        sendAT('GET ECHO');
        // alert("sendAT('GET ECHO') : 1");
        button_press = 10;
        datem_tid = setInterval(datem_start, 5000);
    } else {
        // clearTimeout(p104_tid);
        // clearTimeout(p605_tid);
        // clearTimeout(echo_tid);
        // clearTimeout(datem_tid);
        tids_trace_reset();
      }
    }
    function datem_start() {
        if(login_stage == 4) { // TRACE ON state
            clearTimeout(datem_tid);
            clearTimeout(p104_tid);
            clearTimeout(p605_tid);
            clearTimeout(param_tid);
            sendAT('GET DATEM');
            button_press = 11;
            echo_tid = setInterval(echo_start, 5000);
        } else {
            // clearTimeout(p104_tid);
            // clearTimeout(p605_tid);
            // clearTimeout(echo_tid);
            // clearTimeout(datem_tid);
            tids_trace_reset();
        }
    }

    function p104_start() {
      if(login_stage == 4) {
            clearTimeout(p605_tid);
            clearTimeout(echo_tid);
            clearTimeout(datem_tid);
            clearTimeout(param_tid);
            sendAT('/P104');
            button_press = 14;
            // p104_tid = setInterval(p104_start, 5000);
        } else {
            // clearTimeout(p104_tid);
            // clearTimeout(p605_tid);
            // clearTimeout(echo_tid);
            // clearTimeout(datem_tid);
            tids_trace_reset();
        }      
    }

    function p605_start() {
      if(login_stage == 4) { // TRACE ON state
            clearTimeout(p104_tid);
            clearTimeout(echo_tid);
            clearTimeout(datem_tid);
            clearTimeout(param_tid);
            sendAT('/P605');
            button_press = 15;
            // p605_tid = setInterval(p605_start, 5000);
        } else {
            // clearTimeout(p104_tid);
            // clearTimeout(p605_tid);
            // clearTimeout(echo_tid);
            // clearTimeout(datem_tid);
            tids_trace_reset();
        }      
    }

    function trace_button_check() {
      //log("trace_button_check :"+login_stage);
        if(login_stage == 3 /*|| login_stage == 1*/ || login_stage == 2) {
          if(isDisconnecting == 0){
              log(' → Getting trace data');//log(' <- TRACE ON');
              // sendAT('GET ECHO');
              document.getElementById("id_trace").click();
              // button_press = 10;
              // datem_tid = setInterval(datem_start, 5000);
              // clearTimeout(echo_tid); 

              //sendAT('/P104');
              clearTimeout(p605_tid);
              clearTimeout(echo_tid);
              clearTimeout(datem_tid);
              clearTimeout(param_tid);
              p104_tid = setInterval(p104_start, 1000);//5000);
              button_press = 14;

              login_stage = 4; // TRACE ON state
              isTraceOn=1;
			        isIgnore_2=2; // NEED TO CHECK
          }
        } else {
          log('Device not in Normal mode!');//log('Device not in passthrough mode!');
        }
    }
    function Normal_mode() {        
        if((login_stage >= 3) && (isDisconnecting == 0)) { // currently in PT mode
          sendAT('AT+PT=0');
          // clearTimeout(echo_tid);
          // clearTimeout(datem_tid);
          tids_trace_reset();
          // log(' <- AT+PT=0');
          login_stage = 2;//3; // back to the PT mode
          document.getElementById('btn_mode').innerHTML ='NORMAL MODE';
          // isIgnore=0;
          // isTraceOn=1;
          isIgnore=1;          
        }
        else if (login_stage == 2) { // currently in AT mode
          login_stage = 3;
          clearTimeout(p104_tid);
          clearTimeout(p605_tid);
          clearTimeout(echo_tid);
          clearTimeout(datem_tid);
          clearTimeout(param_tid);
          sendATL('AT+PT=1');
          //setTimeout(trace_button_check, 1000);
          //log(' <- AT+PT=1');
          document.getElementById('btn_mode').innerHTML ='ADVANCED MODE';
        }
        else  {
          log('No device connected!');
        }
    }

    function tids_trace_reset() {
      login_stage = 3; // back to the PT mode
      document.getElementById('btn_trace').innerHTML ='TRACE ON';
      clearTimeout(p104_tid);
      clearTimeout(p605_tid);
      clearTimeout(echo_tid);
      clearTimeout(datem_tid);
      clearTimeout(param_tid);
      isTraceOn=0;
    }

    function trace_off() {  
      //alert("trace_off: isTraceOn="+isTraceOn);
      if((login_stage >= 3) && (isDisconnecting == 0)) {
        if(isTraceOn==1){
          // sendAT('TRACE OFF');
          // document.getElementById('btn_trace').innerHTML ='TRACE ON';
          // clearTimeout(echo_tid);
          // clearTimeout(datem_tid);
          tids_trace_reset();
          log(' → Stopping trace data');//log(' <- TRACE OFF');
          login_stage = 3; // back to the PT mode
          isTraceOn=0;
          isIgnore=1;
        }else{
          // start the static timers
          document.getElementById('btn_trace').innerHTML ='TRACE OFF';
          login_stage = 3;
          clearTimeout(p104_tid);
          clearTimeout(p605_tid);
          clearTimeout(echo_tid);
          clearTimeout(datem_tid);
          clearTimeout(param_tid);
          // sendAT('TRACE ON');
          isTraceOn=1;
          trace_button_check();
  //        isTraceOn=0;
        }
      } else {
          log('Device not in Normal mode!');//log('Device not in passthrough mode!');
      }
    }

    function send_command() {
     // alert("send_command :"+login_stage);
     // log("send_command:: login_stage="+login_stage+" isIgnore="+isIgnore+" isIgnore_2="+isIgnore_2+" isDisconnecting="+isDisconnecting+" button_press="+button_press);

      if(document.getElementById("cmd").value == ""){
        log(" → invalid param request");
        return;  
      }

      if(login_stage >= 1) {
        isIgnore=0;        
        if(login_stage == 4){
          log(" → Press Trace OFF to get params");
          return;
        }else{
          sendAT(document.getElementById('cmd').value); 
        }        
        button_press = 8;
      }
      else {
        log('No device connected!');
      }
    }


    const utf8encoder = new TextEncoder();
    const windows1251 = new TextEncoder();
    var deviceName='REFLECT';
    function utf8ToHex(s)
    {
      const rb = utf8encoder.encode(s);
      //const rb = windows1251.encode(s);
      let r = '';
      for (const b of rb) {
        r += ('0' + b.toString(16)).slice(-2);
        r += ' ';
      }
      return r;
    }

    // Function to flip the hex string (if needed)
    function flipHexString(hexValue, hexDigits) {
      var h = hexValue.substr(0, 2);
      for (var i = 0; i < hexDigits; ++i) {
        h += hexValue.substr(2 + (hexDigits - 1 - i) * 2, 2);
      }
      return h;
    }

    // Function to convert Hex values to float (Need Hex string to start with 0x)
    function hexToFloat(hex) {
      var s = hex >> 31 ? -1 : 1;
      var e = (hex >> 23) & 0xFF;
      return (s * (hex & 0x7fffff | 0x800000) * 1.0 / Math.pow(2, 23) * Math.pow(2, (e - 127)));
    }

    // Function to convert unsigned int 8 bit format to hex and relevant functions within it
    function Uint8tohex(s)
    {
      let a = [];     
      var check;
      var floatval;
      const doc_value = document.getElementById('cmd').value;
      for (let i = 0; i < s.byteLength; i++) {
        check = s.getUint8(i);
        if((i >= 46) && (i < 246) && (((doc_value == "GET ECHO") && (button_press == 8)) || (button_press == 10))) // Changed from (i >= 42) && (i < 242)
        {
          echo[i-46] = check*1000/255;  // Changed from echo[i-42]
        }
        else if((i >= 46) && (i < 246) && (((doc_value == "GET DATEM") && (button_press == 8)) || (button_press == 11)))  // Changed from (i >= 42) && (i < 242)
        {
          datem[i-46] = check*1000/255; // Changed from datem[i-42]
        }
        // a.push(s.getUint8(i));
        a.push('0x' + ('00' + s.getUint8(i).toString(16)).slice(-2));
      }
 
      
      if((((doc_value == "GET ECHO") || (doc_value == "GET DATEM") && (button_press == 8)) || (button_press == 10) || (button_press == 11)) && (s.byteLength == 246)) {
        // Populate the dynamic variables
        level_var = hexToFloat('0x' + ('00' + s.getUint8(0).toString(16)).slice(-2) + ('00' + s.getUint8(1).toString(16)).slice(-2) + ('00' + s.getUint8(2).toString(16)).slice(-2) + ('00' + s.getUint8(3).toString(16)).slice(-2));
        distance_var = hexToFloat('0x' + ('00' + s.getUint8(4).toString(16)).slice(-2) + ('00' + s.getUint8(5).toString(16)).slice(-2) + ('00' + s.getUint8(6).toString(16)).slice(-2) + ('00' + s.getUint8(7).toString(16)).slice(-2));
        volume_var = hexToFloat('0x' + ('00' + s.getUint8(8).toString(16)).slice(-2) + ('00' + s.getUint8(9).toString(16)).slice(-2) + ('00' + s.getUint8(10).toString(16)).slice(-2) + ('00' + s.getUint8(11).toString(16)).slice(-2));
        compensated_var = hexToFloat('0x' + ('00' + s.getUint8(12).toString(16)).slice(-2) + ('00' + s.getUint8(13).toString(16)).slice(-2) + ('00' + s.getUint8(14).toString(16)).slice(-2) + ('00' + s.getUint8(15).toString(16)).slice(-2));
        mA_output_var = hexToFloat('0x' + ('00' + s.getUint8(16).toString(16)).slice(-2) + ('00' + s.getUint8(17).toString(16)).slice(-2) + ('00' + s.getUint8(18).toString(16)).slice(-2) + ('00' + s.getUint8(19).toString(16)).slice(-2));
        temperature_var = hexToFloat('0x' + ('00' + s.getUint8(20).toString(16)).slice(-2) + ('00' + s.getUint8(21).toString(16)).slice(-2) + ('00' + s.getUint8(22).toString(16)).slice(-2) + ('00' + s.getUint8(23).toString(16)).slice(-2));
        gate_start = s.getUint8(24)*256 + s.getUint8(25); //s.getUint8(32)*256 + s.getUint8(33);
        gate_stop = s.getUint8(26)*256 + s.getUint8(27);  //s.getUint8(34)*256 + s.getUint8(35);
        echo_var = s.getUint8(28)*256 + s.getUint8(29);   //s.getUint8(36)*256 + s.getUint8(37);
        noise_var = s.getUint8(30)*256 + s.getUint8(31);  //s.getUint8(38)*256 + s.getUint8(39);
        status_var = s.getUint8(32)*256 + s.getUint8(33); //s.getUint8(40)*256 + s.getUint8(41);

        near_blanking_var = hexToFloat('0x' + ('00' + s.getUint8(34).toString(16)).slice(-2) + ('00' + s.getUint8(35).toString(16)).slice(-2) + ('00' + s.getUint8(36).toString(16)).slice(-2) + ('00' + s.getUint8(37).toString(16)).slice(-2)); //hexToFloat('0x' + ('00' + s.getUint8(42).toString(16)).slice(-2) + ('00' + s.getUint8(43).toString(16)).slice(-2) + ('00' + s.getUint8(44).toString(16)).slice(-2) + ('00' + s.getUint8(45).toString(16)).slice(-2));
        far_blanking_var = hexToFloat('0x' + ('00' + s.getUint8(38).toString(16)).slice(-2) + ('00' + s.getUint8(39).toString(16)).slice(-2) + ('00' + s.getUint8(40).toString(16)).slice(-2) + ('00' + s.getUint8(41).toString(16)).slice(-2));  //hexToFloat('0x' + ('00' + s.getUint8(46).toString(16)).slice(-2) + ('00' + s.getUint8(47).toString(16)).slice(-2) + ('00' + s.getUint8(48).toString(16)).slice(-2) + ('00' + s.getUint8(49).toString(16)).slice(-2));  
        empty_distance = hexToFloat('0x' + ('00' + s.getUint8(42).toString(16)).slice(-2) + ('00' + s.getUint8(43).toString(16)).slice(-2) + ('00' + s.getUint8(44).toString(16)).slice(-2) + ('00' + s.getUint8(45).toString(16)).slice(-2));    //hexToFloat('0x' + ('00' + s.getUint8(50).toString(16)).slice(-2) + ('00' + s.getUint8(51).toString(16)).slice(-2) + ('00' + s.getUint8(52).toString(16)).slice(-2) + ('00' + s.getUint8(53).toString(16)).slice(-2));
        compensated_var_m = convert_to_mtrs(compensated_var);
        if(Math.round(compensated_var_m) == 24.0)
        {
          mode_var = 20.0;
        }
        else
        {
          mode_var = 8.0;
        }
        far_blanking_dist = empty_distance * (100.0 + far_blanking_var)/100.0;
        near_blanking_var = convert_to_measurement_units(near_blanking_var);
        far_blanking_dist = convert_to_measurement_units(far_blanking_dist);
        empty_distance = convert_to_measurement_units(empty_distance);
        mode_var = convert_to_measurement_units(mode_var);

        var xdata = [];
        xdata[0] = 0.00;
        for (let i = 1; i <= 200; i++)
        {
          xdata[i] = Math.round((xdata[i - 1] + (compensated_var/200))*1000)/1000;
        }
        myChart.data.labels = xdata;
        myChart.config.options.scales.x.title.text = p104_units;
        myChart.update();
      }
      return a;
    }



    function data_log_update() {
      var status_str='';
      var level_str='';
      var dist_str='';

        var textarea = document.getElementById('data-log');
        textarea.value = "";

        // var textarea2 = document.getElementById('main-params-log');
        // textarea2.value = "";

        var textarea2 = document.getElementById('level-log');
        textarea2.value = "";

        var textarea3 = document.getElementById('main-params-log-t');
        textarea3.value = "";

        var lvlval = parseFloat(level_var);
        var dstval = parseFloat(distance_var);

        if((lvlval != 0.0) && (dstval != 0.0)) {
      //  if(parseFloat(level_var) > 0){
          level_str = "Lvl: " + level_var.toFixed(3) + " " + p104_units + "\n";
      //  }

      //  if(parseFloat(distance_var) >= 0){
          dist_str = "Dist: " + distance_var.toFixed(3) + " " + p104_units + "\n";
      //  }
          // textarea2.value += level_str + dist_str;
          textarea2.value = level_var.toFixed(3) + " " + p104_units;
          textarea2 = document.getElementById('distance-log');    
          textarea2.value = distance_var.toFixed(3) + " " + p104_units;
          textarea3.value += level_str + dist_str;
        }
        if (status_var != 999){

              bit0 = status_var & 1;
              bit1 = status_var & 2;
              bit2 = status_var & 4;
              bit3 = status_var & 8;
              bit4 = status_var & 16;
              bit5 = status_var & 32;
              bit6 = status_var & 64;
              bit7 = status_var & 128;
              
              if(status_var == 0)
                status_str = "OK";                        
              else {
                  if (bit4 == 16) {
                      if (bit5 == 32)
                          status_str = "LOE fail high";
                      else if (bit6 == 64)
                          status_str = "LOE fail low";
                      else
                          status_str = "LOE fail";
                  }
                  else if (bit3 == 8)
                      status_str= "LOE";
                  else if (bit2 == 4)
                      status_str= "Temp";
                  else if (bit1 == 2)
                      status_str= "Voltage";
                  else if (bit7 == 128)
                      status_str= "Alarm";
                  else
                      status_str= status_var;// + "\n\n";
              }
              // document.getElementById("sensor_status").innerHTML = "<span style='font-sze:12px; color: black; '>"+status_str+"</span>";
              // document.getElementById("sensor_status_t").innerHTML = "<span style='font-sze:12px; color: black; '>"+status_str+"</span>";
              // textarea2.value += status_str;
              textarea2 = document.getElementById('status-log');
              textarea2.value = status_str;
              textarea3.value += "Status: " + status_str;
            }       
        
        // document.getElementById("lvl").innerHTML = "<span style='font-sze:12px; color: black; '>"+level_str+"</span>";
        // document.getElementById("dist").innerHTML = "<span style='font-sze:12px;color: black;  '>"+dist_str+"</span>";

        textarea.value += "Volume\t= " + volume_var.toFixed(3) + " " + p605_units + "\n";
        textarea.value += "Temp\t= " + temperature_var.toFixed(2) + " °C" + "\n";
        // textarea.value += "Noise\t\t= " + noise_var.toFixed(0) + " mV" + "\n";
        textarea.value += "Output\t= " + mA_output_var.toFixed(2) + " mA";

        // on the trace tab
        // document.getElementById("lvl_t").innerHTML = "<span style='font-sze:12px; color: black; '>"+level_str+"</span>";
        // document.getElementById("dist_t").innerHTML = "<span style='font-sze:12px;color: black;  '>"+dist_str+"</span>";      
        var textarea1 = document.getElementById('data-log_t');
        textarea1.value = "";
        textarea1.scrollTop = textarea.scrollHeight;
        textarea1.value=textarea.value;
    }

    function populate_params(string_val){
      if(string_val.includes("/P100:")) {
        document.getElementById('p100-box').value = string_val.slice(string_val.lastIndexOf(':') + 1);//string_val.substring(string_val.indexOf(':') + 1);
        param_query = 1;
      }
      else if(string_val.includes("/P104:")) {
        document.getElementById('p104-box').value = string_val.slice(string_val.lastIndexOf(':') + 1);//string_val.substring(string_val.indexOf(':') + 1);
        p104_units_val = parseInt(document.getElementById('p104-box').value);
        p104_measurement_units();  // Update the measurement units to be displayed
        if(isTraceOn == 1) {
          //sendAT('/P605');
          clearTimeout(p104_tid);
          clearTimeout(echo_tid);
          clearTimeout(datem_tid);
          clearTimeout(param_tid);
          p605_tid = setInterval(p605_start, 1000);//5000);
          button_press = 14;
        }
        param_query = 2;
      }
      else if(string_val.includes("/P105:")) {
        document.getElementById('p105-box').value = string_val.slice(string_val.lastIndexOf(':') + 1);//string_val.substring(string_val.indexOf(':') + 1);
        param_query = 3;
      }
      else if(string_val.includes("/P106:")) {
        document.getElementById('p106-box').value = string_val.slice(string_val.lastIndexOf(':') + 1);//string_val.substring(string_val.indexOf(':') + 1);
        param_query = 4;
      }
      else if(string_val.includes("/P808:")) {
        document.getElementById('p808-box').value = string_val.slice(string_val.lastIndexOf(':') + 1);//string_val.substring(string_val.indexOf(':') + 1);
        param_query = 5;
      }
      else if(string_val.includes("/P605:")) {
        document.getElementById('p605-box').value = string_val.slice(string_val.lastIndexOf(':') + 1);//string_val.substring(string_val.indexOf(':') + 1);
        p605_units_val = parseInt(document.getElementById('p605-box').value);
        p605_volume_units();  // Update the volume units to be displayed
        if(isTraceOn == 1) {

          // sendAT('GET ECHO');
          // button_press = 10;
          // datem_tid = setInterval(datem_start, 5000);
          clearTimeout(p605_tid);
          clearTimeout(datem_tid);
          clearTimeout(p104_tid);
          clearTimeout(param_tid);
          echo_tid = setInterval(echo_start, 1000);//5000);

        }
        param_query = 6;     
      }
      else if(string_val.includes("/P21:")) {
        document.getElementById('p21-box').value = string_val.slice(string_val.lastIndexOf(':') + 1);//string_val.substring(string_val.indexOf(':') + 1);
        param_query = 7;
      }
    }


// Incoming GATT notification was received
async function incomingData(event){
      // Read data from BLE CodeLess peer
      let readInValue = await outboundChar.readValue();
      let decoder = new TextDecoder('utf-8');
      // var checkBox = document.getElementById("myCheck");
      const doc_value = document.getElementById('cmd').value;
      const string_check =  decoder.decode(readInValue).replace('\r','\r ← ').replace('\n','').replace('\0','');
      //alert("button_press="+button_press+" readInValue="+readInValue+"login_stage="+login_stage+" string_check="+string_check);
      //alert(login_stage + " " +isIgnore);
      // alert(string_check + "1");
      //log("login_stage="+login_stage+" isIgnore="+isIgnore+" isIgnore_2="+isIgnore_2+" isDisconnecting="+isDisconnecting+" button_press="+button_press);
      
      



      if( isIgnore_2 === 2 ){ //NEED TO CHECK
          isIgnore_2 = 0;          
          //await sleep(2 * 1000);
          //return;
      }

      

      if(isIgnore==1) 
      {
          isIgnore=0;
          return; //--> need to check
      }

     

      //alert(string_check + "2");
      if ((button_press == 10) || (button_press == 11) || ((button_press == 8) && ((doc_value == "GET ECHO") || (doc_value == "GET DATEM"))))
      {
        var hex = Uint8tohex(readInValue);
        if((button_press == 10) || ((button_press == 8) && (doc_value == "GET ECHO")))
          log(" ← ECHO Received");
        else if ((button_press == 11) || ((button_press == 8) && (doc_value == "GET DATEM")))
          log(" ← DATEM Received");        
      }
      else
      { 
        //alert(string_check + "3");
        if(string_check.includes("Entered PASSTHROUGH mode"))
        {
            login_stage = 3; // Entered PT mode
            log(" ← Log in Success");            
        }
        else if(string_check.includes("Exit PASSTHROUGH mode")){          
          //alert("Exit : isIgnore="+isIgnore+" login_stage="+login_stage+" isDisconnecting="+isDisconnecting+" string_check="+string_check);
          login_stage = 2;  // moving to AT mode
        }
        else if(string_check.includes("PASSTHROUGH failed")){          
          login_stage = 2;
          log(" ← Normal mode failed");            
        }
        else if(string_check.includes("Logged In Success") || (string_check.includes("OK")  && login_stage == 1)){
          login_stage = 2;  // Logged in success mode
          closeForm();
          if(isDisconnecting == 0){
            log(" ← Connected");
            sendATL('AT+PT=1');
            setTimeout(trace_button_check, 2000);//3000); // UNDER TEST 1
          }else {
           // alert(isDisconnecting+" ::"+string_check);
            log(" ← disconnecting");
          }
        }
        else if( ( string_check.includes("ERROR") || string_check.includes("Logged In failed")) && login_stage == 1 )
        {
            document.getElementById('lblpsw').innerHTML ='login failed';
            document.getElementById('lblpsw').style.color = "red";
            document.getElementById("pswbox").value='';
            openForm();
        }
        else{
          var disp=0;
          if((button_press >=20) && (button_press <=26) || (string_check.includes("/P")))
            populate_params(string_check);
          //alert(string_check+"st");
          if( (isTerminated === 1) || (isDisconnecting === 1) || (isDisconnecting === 2) ){
            disp = 1;
            await sleep(2 * 1000);
          }
          
          
          if( disp == 0){          
            if(sysState == 2 && string_check.length > 12){
              //log(" ← param state" + sysState );
            }else {
              log(" ← " + string_check );
            }
          }
          
          //alert(string_check + "2");
            // Log the incoming string (format slightly)
          //var res=decoder.decode(readInValue).replace('\r','\r <- ').replace('\n','').replace('\0','');          
          //log(" <- " + sizeof(res) + " "+res);
          //await sleep(2 * 1000);
        }        
      }
    }
  
    async function onDisconnected()
    {
      log(" → Bluetooth connection terminated!");
      button_press=0;
      tids_trace_reset();
      login_stage = 0;
      isDisconnecting=0; // completed
      isTerminated=1;
    }
    
    async function bleTDisconnect()
    {
      //log("login_stage="+login_stage+" isIgnore="+isIgnore+" isIgnore_2="+isIgnore_2+" isDisconnecting="+isDisconnecting+" button_press="+button_press);
      if (device.gatt.connected) {
          device.gatt.disconnect();
          log(" → Disconnected");
      }
      else {
          log(' → Bluetooth Device is already disconnected');
          
      }
      button_press=0;
      login_stage = 0;
      isDisconnecting=0; // completed
      // isTerminated=0;
      //await sleep(3 * 1000);  // NOT NECESSARY
    }

    async function bleT1Disconnect()
    {
      if(login_stage >= 2) {
        sendATL('AT+PT=0'); //--> BB: commented
        await sleep(3 * 1000);
        isDisconnecting=1;
        // log("login_stage="+login_stage+" isIgnore="+isIgnore+" isIgnore_2="+isIgnore_2+" isDisconnecting="+isDisconnecting+" button_press="+button_press);
        bleTDisconnect();//setTimeout(bleTDisconnect,1000);
      }
      else if (login_stage == 1) {
        bleTDisconnect();//setTimeout(bleTDisconnect,1000);
      } 
      else {
        log('No device connected!');
      }
    }

    async function bleDisconnect()
    {
      
	    isIgnore_2=1;
      isDisconnecting=2;
      //log("login_stage="+login_stage+" isIgnore="+isIgnore+" isIgnore_2="+isIgnore_2+" isDisconnecting="+isDisconnecting+" button_press="+button_press);

      // if(login_stage == 4){
      //   sendAT('TRACE OFF');
      // }      
      // clearTimeout(echo_tid);
      // clearTimeout(datem_tid);
      tids_trace_reset();
      document.getElementById('btn_trace').innerHTML ='TRACE OFF';
      // document.getElementById('btn_mode').innerHTML ='ADVANCED MODE';

      log(" → Disconnecting");
      bleT1Disconnect();//setTimeout(bleT1Disconnect,1000);
    }

    // go to the reflect manual page
    async function bleExit1Page(){      
      if(login_stage >0){
        bleDisconnect();
      }
      login_stage=0;
      window.open("https://pulsarmeasurement.com/dbr-radar", '_blank').focus;
    }

    // go to Pulsar home page  
    async function bleExitPage(){      
      if(login_stage >0){
        bleDisconnect();
      }
      login_stage=0;
      window.open("https://pulsarmeasurement.com", '_blank').focus;
    }


    async function bleExitPage2(){
      if(login_stage >0){
        bleDisconnect();
        login_stage=0;
      }      
    }

/*
    sendATL commandto be used for only the AT+PT or AT+AUTH
    rest, use the sendAT command
*/
  // Send an AT command to the CodeLess BLE peer
  async function sendATL(cmd) {
      //log("ww"+cmd);
      //log("sendATL:: login_stage="+login_stage+" isIgnore="+isIgnore+" isIgnore_2="+isIgnore_2+" isTerminated="+isTerminated+" isDisconnecting="+isDisconnecting);

      if(isIgnore_2 == 1 || isDisconnecting == 2){
        return;
      }

      if(cmd === 'AT+PT=1'){
          log(' → Logging ...'   );
          await sleep(2 * 1000); // needed 
          isIgnore=1;
      }
      else if(cmd.includes("AT+AUTH="))      
      {
      }
      else if(cmd === 'AT+PT=0'){
        //log(' → Connecting ...'   );
      }
      else if(isDisconnecting == 2 ){
        log(' → Disconnecting ...'   );
        isDisconnecting=0;
      }else{
        log(' → Connecting ...'   );
      }

      // Append an extra character as expected by CodeLess
      var commandToSend = cmd + "\0";
      try{
        let encoder = new TextEncoder('utf-8');
        // Send command via GATT Write request 
        await inboundChar.writeValue(encoder.encode(commandToSend));
      } 
      catch(error) {
        log('Failed: ' + error);
      }
    }

      async function ble_connect() {
        isIgnore_2=0; isDisconnecting =0;  isTerminated=0;

      try {
        // Define a scan filter and prepare for interaction with Codeless Service
          log('');
          log('Requesting Bluetooth Device...');
          device = await navigator.bluetooth.requestDevice(options);
          log('Name: ' + device.name);
          deviceName='REFLECT: '/*+ '\n' + device.name;*/
          document.getElementById('id_title').innerHTML =deviceName;
          document.getElementById('device_title').innerHTML =device.name;
  
        device.addEventListener('gattserverdisconnected', onDisconnected);	
        // Connect to device GATT and perform attribute discovery
        server = await device.gatt.connect();
        const service = await server.getPrimaryService(CODELESS_SVC_UUID);
        inboundChar = await service.getCharacteristic(INBOUND_CHAR_UUID);
        outboundChar = await service.getCharacteristic(OUTBOUND_CHAR_UUID);
        const flowcontrolChar = await service.getCharacteristic(CNTRL_CHAR_UUID);
        await flowcontrolChar.startNotifications();
        flowcontrolChar.addEventListener('characteristicvaluechanged', incomingData);
        log('Ready to communicate!\n');
        login_stage = 1;
        // sendATL('AT+AUTH=123321'); //--> BB: commented
        //sendATL('AT+AUTH=123654'); //--> BB: commented
        sendATL('AT+AUTH=000000'); //--> BB: commented
        button_press = 3;
      }
      catch(error) {
        log('Failed: ' + error);
      }
    }


// Send an AT command to the CodeLess BLE peer
async function sendAT(cmd) {
      // Display the command in the log
      log(' → ' + cmd );
      // Append an extra character as expected by CodeLess
      var commandToSend = cmd + "\0";
      try{
        let encoder = new TextEncoder('utf-8');
        // Send command via GATT Write request 
        await inboundChar.writeValue(encoder.encode(commandToSend));
      } 
      catch(error) {
        log('Failed: ' + error);
      }
    }
    // If enter key was pressed by user while editing, send command immediately
    function wasEnter(elem) {
      if(event.key == 'Enter') {
        if(login_stage >= 1) {
          isIgnore=0;

          if(document.getElementById("cmd").value == ""){
            log(" → invalid param request");
            return;  
          }

          if(login_stage == 4) {
    	      log(" → Press Trace OFF to get params");
    	      return;
	        } else {
            button_press = 8;
            sendAT(document.getElementById("cmd").value);
          }
        }
        else {
          log('No device connected!');
        }
      }
    }

    // Check and decide the parameter recall for selected number of parameters
    function param_check() {
      if((login_stage >= 3) && (isDisconnecting == 0)) {
      tids_trace_reset();
      isIgnore=0;
        switch(button_press) {
          case 20:
            if(document.getElementById("p100-box").value == "")
              sendAT('/P100');
            else
              sendAT('/P100:'+ document.getElementById("p100-box").value);
              document.getElementById("p100-box").value = "";
            break;
          case 21:
            if(document.getElementById("p104-box").value == "")
              sendAT('/P104');
            else
              sendAT('/P104:'+ document.getElementById("p104-box").value);
            document.getElementById("p104-box").value = "";         
            break;
          case 22:
            if(document.getElementById("p105-box").value == "")
              sendAT('/P105');
            else
              sendAT('/P105:'+ document.getElementById("p105-box").value);
            document.getElementById("p105-box").value = "";    
            break;
          case 23:
            if(document.getElementById("p106-box").value == "")
              sendAT('/P106');
            else
              sendAT('/P106:'+ document.getElementById("p106-box").value);            
            document.getElementById("p106-box").value = "";
            break;
          case 24:
            if(document.getElementById("p808-box").value == "")
              sendAT('/P808');
            else
              sendAT('/P808:'+ document.getElementById("p808-box").value);
            document.getElementById("p808-box").value = "";        
            break;
          case 25:
            if(document.getElementById("p605-box").value == "")
              sendAT('/P605');
            else
              sendAT('/P605:'+ document.getElementById("p605-box").value);
            document.getElementById("p605-box").value = "";           
            break;                        
          case 26:
            if(document.getElementById("p21-box").value == "")
              sendAT('/P21');
            else
              sendAT('/P21:'+ document.getElementById("p21-box").value);
            document.getElementById("p21-box").value = "";        
            break; 
          default:
            break;
        }
      } else {
        log('Device not in Normal mode!');
      }
    }
  
    // If enter key was pressed by user while editing the parameters, send command immediately
    function wasEnter2(elem) {
      if(event.key == 'Enter') {
        param_check();
      }
    }

    function log_2(text)
    {
      //log("log:: login_stage="+login_stage+" isIgnore="+isIgnore+" isIgnore_2="+isIgnore_2+" isDisconnecting="+isDisconnecting);
      

      var textarea = document.getElementById('log');
      if(textarea.value == "")
        textarea.value = text;
      else
        textarea.value += "\n" + text;	  
      textarea.scrollTop = textarea.scrollHeight;
    }


    // Display text in log field text area 
    function log(text)
    {
     // log_2("log:: login_stage="+login_stage+" isIgnore="+isIgnore+" isIgnore_2="+isIgnore_2+" isDisconnecting="+isDisconnecting+" isTerminated="+isTerminated);
        // log_2("");
        if(isIgnore_2==1 || isDisconnecting ==1 || isDisconnecting ==2 || isTerminated==1){
          if(isIgnore_2==1) isIgnore_2=0;
          // if(isTerminated==1) isTerminated=0;
          //log_2("log::size "+sizeof(text));
         // if(sizeof(text) > 100)  return;
        }

      var textarea = document.getElementById('log');
      if(textarea.value == "")
        textarea.value = text;
      else
        textarea.value += "\n" + text;	  
      textarea.scrollTop = textarea.scrollHeight;
    }

    // Clears text in log field text area 
    function clearlog()
    {
      var textarea = document.getElementById('log');
      textarea.value = "";	  
      textarea.scrollTop = textarea.scrollHeight;
    }
</script>

<script>

function myLoadFunction() {  
  log("Please click on the 'Device scan' to scan");
}

  function search(ele) {    
    if(event.key === 'Enter') {
        //alert(ele.value);
        event.preventDefault();        
        document.getElementById("btnLogin").click();        
    }
}

  </script>
  


<style>
	.button {
        background-color: rgb(51, 179, 74);
        border: none;
        color: white;
	    /* padding: 15px 32px; */
        height:100px;
        width: 268px;
        /* width:160px; */
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        font-size: 36px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 8px;
	}
	.textarea_c {
        background-color: white;
        border: none;
        /* color: white; */
        /* padding: 10px 30px; */
        height:  270px;
        width: 273;
        text-align: left;
        text-decoration: none;
        display: inline-block;
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        font-size: 240px;
        margin: 4px 2px;
        cursor: pointer;
        resize: none;
	}
	.textarea1 {
        background-color: white;
        border: none;
        /* color: white; */
        /* padding: 10px 30px; */
        height:  170px;
        width: 273px;
        text-align: left;
        text-decoration: none;
        display: inline-block;
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        font-size: 240px;
        margin: 4px 2px;
        cursor: pointer;
        resize: none;
        left:10px;
	} 
  .textarea2 {
        background-color: white;
        border: none;
        /* color: white; */
        /* padding: 10px 30px; */
        height:  170px;
        width:  500px;
        text-align: left;
        text-decoration: none;
        display: inline-block;
        font-size: 240px;
        margin: 4px 2px;
        cursor: pointer;
        resize: none;
        left:10px;
	} 
	</style>


<style>
  .container1{
    display: flex;
  }
  .fixed{
      width: 200px;
  }
  .flex-item{
      flex-grow: 1;
  }
  .blocks_textbox {
    display: inline-block; 
    /* border: solid 2px red;    */
    /* padding: 16px 20px; */
    display: flex;
    align-items: left;
    justify-content: left;
    margin: 0 auto;
    height:50px; 
    width: 100px;
    font-weight: bold;
    font-size:medium;
    color: rgb(0, 0, 0);
    /* font-family: "verdana"; */
    font-size: 4.5em;
    overflow: scroll;
  /*Hide content before animation*/
    /* border-right: .1em solid white; */
  /*Cursor*/
    white-space: nowrap;
  /*Keep text on same line*/
    margin: 0 auto;
  /*Scrolling effect while typing*/
    letter-spacing: .1em;
    animation: typing 3s steps(30, end), blink-caret .75s steps(1, end) infinite alternate;    
  }
  
  .blocks {
    display: inline-block; 
    /* border: solid 2px red;    */
    /* padding: 16px 20px; */
    display: flex;
    align-items: left;
    justify-content: left;
    margin: 0 auto;
    /* height:50px; 
    width: 100px; */
    font-weight: bold;
 
    color: rgb(0, 0, 0);
    /* font-family: "verdana"; */
    font-size: 3.5em;
    overflow: hidden;
  /*Hide content before animation*/
    /* border-right: .1em solid white; */
  /*Cursor*/
    white-space: nowrap;
  /*Keep text on same line*/
    margin: 0 auto;
  /*Scrolling effect while typing*/
    letter-spacing: .1em;
    animation: typing 3s steps(30, end), blink-caret .75s steps(1, end) infinite alternate;    
  }
  .blocks_txtarea {
    display: inline-block; 
    /* border: solid 2px red;    */
    /* padding: 16px 20px; */
    display: flex;
    align-items: left;
    justify-content: left;
    margin: 0 auto;
    /* height:50px; 
    width: 100px; */
    font-weight: bold;
    font-size:medium;
    color: rgb(0, 0, 0);
    /* font-family: "verdana"; */
    font-size: 4.5em;
    overflow: hidden;
  /*Hide content before animation*/
    /* border-right: .1em solid white; */
  /*Cursor*/
    white-space: nowrap;
  /*Keep text on same line*/
    margin: 0 auto;
  /*Scrolling effect while typing*/
    letter-spacing: .1em;
    animation: typing 3s steps(30, end), blink-caret .75s steps(1, end) infinite alternate;    
}
.wrap{
    width:210px;    
}
 
/* Button used to open the contact form - fixed at the bottom of the page */
.open-button {
  background-color: #555;
  color: white;
  padding: 16px 20px;
  border: none;
  cursor: pointer;
  opacity: 0.8;
  position: fixed;
  bottom: 23px;
  right: 28px;
  width: 280px;
}

 /* The popup form - hidden by default */
  .form-popup {
    display: none;
    /* position: fixed; */
    position: relative;    
    right: 0px;
    bottom: 0px;
    top: 0px;
    left: 0px;
    width: 508px;
    max-width: 600px;
    border: 1px solid #03681cd0;
    z-index: 9;
}

 /* Add styles to the form container */
  .form-container {
    max-width: 600px;
    width: 505px;
    padding: 10px;
    background-color: white;
  }
  
  /* Full-width input fields */
  .form-container input[type=text], .form-container input[type=password] {
    width: 100%;
    padding: 15px;
    margin: 5px 0 22px 0;
    border: none;
    background: #f1f1f1;
  }
  
  /* When the inputs get focus, do something */
  .form-container input[type=text]:focus, .form-container input[type=password]:focus {
    background-color: #ddd;
    outline: none;
  }
  
  /* Set a style for the submit/login button */
  .form-container .btn {
    background-color: #04AA6D;
    color: rgb(255, 255, 255);
    padding: 16px 20px;
    border: none;
    cursor: pointer;
    width: 50%;
    margin-bottom:10px;
    opacity: 0.8;    
  }
  
  /* Add a red background color to the cancel button */
  .form-container .cancel {
    background-color: rgb(55, 85, 7);
  }
  
  /* Add some hover effects to buttons */
  .form-container .btn:hover, .open-button:hover {
    opacity: 1;
  }
</style>


<script>
  function openForm() {
    document.getElementById("myForm").style.display = "block";
  }

  function sendLoginCmd() {
    //alert("sendLoginCmd"+'AT+AUTH='+document.getElementById("pswbox").value);
    sendATL('AT+AUTH='+document.getElementById("pswbox").value);
  }
  function closeForm2() {
    document.getElementById('lblpsw').innerHTML ='';
    document.getElementById('lblpsw').style.color = "black";
  }
  
  function closeForm() {
    
    document.getElementById("myForm").style.display = "none";
  }
  function updateState(cur_state) {
    // log(cur_state);
    sysState=cur_state;
  }

  

  </script>



<link href="css/style.css" rel="stylesheet">
<link href="css/slider.css" rel="stylesheet">

<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
<link href="css/element.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Jura" rel="stylesheet">
<script src="js/jquery-2.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="./js/ekko-lightbox.js"></script>
<script src="js/slider.js"></script>



<style>
  table {
    border-collapse: collapse;
    width: 100%;
  }
  
  th, td {
    text-align: left;
    padding: 8px;
  }
  
  tr:nth-child(even) {
    background-color: #D6EEEE;
  }
  </style>
<link rel="icon" type="image/x-icon" href="./img/pulsaricon-rgb64_2.png" /> 
</head>
<!-- <body onload="myLoadFunction()" onbeforeunload="return bleExitPage2()"> -->
<body onload="myLoadFunction()"></body>
<!-- partial:index.partial.html -->
<section class="accordion">
<section id="header">
    <table>
      <tr style="width:100%">
          <td>
              <div class="logo">
                <a href="" style="text-decoration:none;">
                  <img src="./img/pulsarlogo-old.svg"  alt="Logo" onclick="bleExitPage();" style="width:300px;height:80px;border:none;text-decoration:none;color:#eeeeee00;">
                </a>
              </div>
          </td>
          <td>      
            <div class="my_text" id="id_title"  style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: rgb(155, 156, 160); text-align: center;">
              REFLECT
            </div>
            <div class="my_text" id="device_title"  style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 50px; color: white; text-align: center;"></div>
          </td> 
          <td></td><td></td>
          <td></td><td></td>    
          <td></td><td></td>       
          <td>
             <div class="logo1">
              <a href="" style="text-decoration:none;">
                <!-- <img src="./img/dbr16.png"  alt="Logo" style=" width: 90px;;height: 90px;;border:none;text-decoration:none;color:#eeeeee00;">  -->
                <img src="./img/Icon256Reflect_new.png"  alt="Logo" onclick="bleExit1Page();" style=" width: 160px;;height: 160px;;border:none;text-decoration:none;color:#eeeeee00;"> 
              </a>
            </div>
          </td>        
          </tr>
      </table>            
    </section>

    
    <section class="accordion-tabs">
      <button class="accordion-tab accordion-active" data-actab-group="0" data-actab-id="0" id="id_home" onclick="c_state=0;updateState(c_state);" >Home</button>
      <button class="accordion-tab" data-actab-group="0" data-actab-id="1" id="id_trace" onclick="c_state=1;updateState(c_state);">Trace</button>
      <button class="accordion-tab" data-actab-group="0" data-actab-id="2" id="id_parameters" onclick="c_state=2;updateState(c_state); param_update();">Settings</button>      
    </section>
    <section class="accordion-content">

    <!-- <div id="param_fields_main" style=" width:1080px; height:1080px; border-style: solid; border-width: 1px; border-radius: 10px;  border-color: rgba(243, 112, 33, 0.952);"> -->
      
      <article class="accordion-item accordion-active" data-actab-group="0" data-actab-id="0">
        <h4 class="accordion-item__label"></h4><!-- IMPORTANT : donot remove this tag-->
        <div class="accordion-item__container">
          <div id="home_tab" style='top:-40%;  left: -20%; width:68%; height:100%; border-style:solid; border-width: 3.5px; border-radius: 10px;  border-color: rgba(243, 112, 33, 0.952);' align="center">
          <table>
            <tr>               
                <td></td><td></td>
                <td></td><td></td>
                <td></td><td></td>                                
                <!-- <td><button type="button" class="button button-style1" onclick="sendATL('AT+AUTH=123321');  button_press = 3">Test-Login</button></td> -->
                <!-- <td><button type="button" class="button button-style1" onclick="openForm();  button_press = 3">Login</button></td> -->
            </tr>                    
          </table>
                    <div class="form-popup" id="myForm">
                      <form action="" class="form-container">
                        <h1>Login</h1>            
                        <!-- <label for="email"><b>Email</b></label>
                        <input type="text" placeholder="Enter Email" name="email" required> -->
                        <label for="psw" id="lblpsw" ><b>Passcode</b></label>
                        <input type="password" placeholder="Enter Passcode" id="pswbox" name="psw" onkeydown="search(this)" required>            
                        <button type="button" id="btnLogin" class="btn" onclick="closeForm(); sendLoginCmd(); closeForm2();  ">Login</button>
                        <!-- <button type="button" class="btn cancel" onclick="closeForm()">Close</button>  -->
                      </form>
                    </div>                    
                    <table><tr><td></td><td><div></div></td></tr></table>
   
                    <table style="width:100%">

                      <tr>
                        <td><button type="button" class="button button-style1" onclick="ble_connect(); button_press = 1">Device Scan</button></td>
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>
                        <!-- <td></td> -->
                        <td><button type="button" class="button button-style1" onclick="bleDisconnect();  button_press = 2">End Session</button></td>
                      </tr>
                    </table>

                    <table style="width:100%">
                      <tr>
                        <td><label id = "data-log-label" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: bold; width:80px; height:80px;">Data Log</label></td>
                        <td><label id = "parameters-label" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: bold; width:80px; height:80px;">&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Live Parameters</label></td>
                      </tr>
                    </table>

                    <table style="width:100%">
                      <tr>
                        <td>
                          <textarea id="log" class="textarea_c" rows="8" cols="10" style="font-size: 16pt; font-weight: bold; width:420px; height:560px;" readonly></textarea>
                        </td>
                        <td>
                        <table style="width:10%">
                          <!-- <tr>
                            <td> -->
								<!-- needs to be changed back to label, as we get better control -->
                              <!-- <div class = "blocks" id='lvl'></div> 
                              <div class = "blocks" id='dist'></div>
                              <div class = "blocks" id='sensor_status'></div> -->
                              <!-- <textarea id="main-params-log" class="textarea3" rows="6" cols="8" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 40pt; font-weight: 500; width:380px; height:300px; background: rgb(228, 236, 237); resize:none; border: none;" readonly></textarea>
                            </td>
                          </tr> -->
                          <tr>
                            <td><label id = "level-label" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; ">Level:</label></td>
                          </tr>
                          <tr>
                            <td>
                              <textarea id="level-log" class="textarea2" rows="1" cols="8" style="font-size: 40pt; font-weight: bold; width:380px; height:70px;" readonly></textarea>
                            </td>
                          </tr>
                          <tr>
                            <td><label id = "distance-label" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; ">Distance:</label></td>
                          </tr>
                          <tr>
                            <td>
                              <textarea id="distance-log" class="textarea2" rows="1" cols="8" style="font-size: 40pt; font-weight: bold; width:380px; height:70px;" readonly></textarea>
                            </td>
                          </tr>
                          <tr>
                            <td><label id = "status-label" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; ">Status:</label></td>
                          </tr>
                          <tr>
                            <td>
                              <textarea id="status-log" class="textarea2" rows="1" cols="8" style="font-size: 40pt; font-weight: bold; width:380px; height:70px;" readonly></textarea>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <textarea id="data-log" class="textarea2" rows="8" cols="8" style="font-size: 22pt; font-weight: bold; width:380px; height:110px;" readonly></textarea>
                            </td>
                          </tr>
                          </table>
                        </td>
                      </tr>
                    </table>

                    <table style="width:100%">
                      <tr>
                        <td><label id = "command-box-label" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: bold; width:80px; height:80px;">Command Box</label></td>
                      </tr>
                    </table>
                  

                  <table style="width:100%">
                  <tr>
                    <td><input type="text" placeholder="Enter the command to send" id="cmd" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 30pt; font-weight: bold; width:546px; height:80px; " onkeydown="wasEnter(this)"></td>
 
                    <td>
                        <button type="button" class="button" onclick="send_command();">
                            SEND
                        </button>
                      </td>                          

                    <td> 
                    </td>
                  </tr>                      
                  </table>
                  <table style="width:80%;">
                    <tr>
                      <table style="width:100%;">
                        <!-- <td style="position: center;">
                          <button type="button" class="button button-style1" id="btn_trace1" onclick="button_press=10; trace_off();">TRACE OFF</button>
                          <script>
                            document.getElementById("btn_trace1").style.visibility="hidden";
                          </script>
                        </td>
                        <td style="position: center;">
                          <button type="center" class="button button-style1" id="btn_mode" visibility="hidden" onclick="button_press = 13; Normal_mode();">ADVANCED MODE</button>
                          <script>
                            document.getElementById("btn_mode").style.visibility="hidden";
                          </script>
                        </td> -->
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>     
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>  
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>  
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>  
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>  
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td>
                        <td>
                          <button type="button" class="button" onclick="clearlog(); button_press = 9">
                            CLEAR
                          </button>
                        </td>
                      </table>
                      
                    </tr>                    
                  </table>
              </div>
          </div>
      </article>
      <article class="accordion-item" data-actab-group="0" data-actab-id="1">
        <h4 class="accordion-item__label"> </h4> <!-- IMPORTANT : donot remove this tag-->
        <div id="trace_tab" style='top:-40%;  left: -20%; width:68%; height:100%; border-style: solid; border-width: 3.5px; border-radius: 10px;  border-color: rgba(243, 112, 33, 0.952);' align="center">
        <div class="accordion-item__container">
          
          <table>
            <tr>               
                <td></td><td></td>
                <td></td><td></td>
                <td></td><td></td>                                
                 <!-- <td><button type="button" class="button button-style1" onclick="sendATL('AT+AUTH=123321');  button_press = 3">Test-Login</button></td> -->
            </tr>                    
          </table>

          <!-- <p>reprehenderit temporibus, assumenda cupiditate consequatur soluta odit ex repudiandae delectus cumque, provident hic sed quod? Quis, nam. Similique eaque quae vel recusandae expedita qui sint fugiat, nisi assumenda et ex molestiae atque deleniti magni, ipsam libero!</p> -->
           <!-- start of trace box --> 
           <table style="width:100%"> <!-- check here: start of the trace box -->
            <tr>
              <td>
                <div class="chartBox" style="position: left; margin: auto; height:100%; width:52rem">
                    <canvas id="myChart"></canvas>
                </div>  
              </td>                 
                <!-- Offline mode -->
                <script src="./js/chart.js"></script>
                <script>
                // X points/labels
                var xdata = [];
                var pts = 0.50;//0.036;//7.2/200;
                xdata[0] = 0.00;
                for (let i = 1; i <= 200; i++) {
                    xdata[i] = Math.round((xdata[i - 1] + 0.036)*1000)/1000;
                }

                // Echo variables
                var echo = [];

                // Datem variables
                var datem = [];
                for (let i = 0; i < 200; i++) {
                    echo[i] = 0;
                    datem[i] = 0;
                }
                // setup block
                var data = {
                    labels: xdata,            
                    datasets: [{
                        type: 'line',
                        label: 'Datem',   // Datem array
                        data: datem,
                        radius: 1,
                        pointRadius: 1,
                        borderWidth: 2,
                        backgroundColor: 'rgba(75, 119, 190, 1)',
                        borderColor:     'rgba(75, 119, 190, 1)'
                    },
                    {
                        type: 'line',
                        label: 'Echo',    // Echo array
                        data: echo,
                        radius: 1,
                        pointRadius: 1,
                        borderWidth: 2,
                        backgroundColor: 'rgba(255, 0, 0, 1)',
                        borderColor:     'rgba(255, 0, 0, 1)'
                    },
                    ]
                };
                
                // arbitraryLine Plugin
                var arbitraryLine = {       // Fills near & far blanking areas, Plots Distance, gate start and stop. Shows dynamic variables
                    id: 'arbitraryLine',
                    beforeDraw(chart, args, options) {
                        const ctx = chart.canvas.getContext('2d');
                        var { ctr, chartArea: {top, right, bottom, left, width, height}, scales:
                            {x, y} } = chart;
                        ctx.save();
                        //alert("Near = " + near_blanking_var + ", Far = " + far_blanking_dist + ", Empty = " + empty_distance + ", Compensated = " + compensated_var + ", Mode = " + mode_var);
                        ctx.fillStyle = 'yellow';
                        ctx.fillRect(x.getPixelForValue(0), top, near_blanking_var*width/compensated_var, height); // Near blanking area (x.getPixelForValue(0), top, 0.3*width/7.2, height)
                        ctx.fillStyle = 'yellow';
                        ctx.fillRect(x.getPixelForValue((200.0/1.2)*empty_distance/mode_var), top, width*(far_blanking_dist - empty_distance)/compensated_var, height); // Far blanking area
                        ctx.strokeStyle = 'red';
                        ctx.strokeRect(x.getPixelForValue(distance_var*200/compensated_var), top, 0, height);  // Distance//(x0, y0, x1, y1); (x.getPixelForValue(distance_var*200/7.2), top, 0, height)
                        ctx.strokeStyle = 'black';
                        ctx.strokeRect(x.getPixelForValue(gate_start/5), top, 0, height);  // Gate start (x.getPixelForValue((distance_var - 0.20)*200/7.2), top, 0, height)
                        ctx.strokeStyle = 'black';
                        ctx.strokeRect(x.getPixelForValue(gate_stop/5), top, 0, height);  // Gate stop (x.getPixelForValue((distance_var + 0.20)*200/7.2), top, 0, height)
                        ctx.fillStyle = 'black';
                        data_log_update();                  
                        // ctx.fillText("Length          = " + level_var.toFixed(3) + " m", x.getPixelForValue(140), top+10); // Dynamic variables
                        // ctx.fillText("Distance       = " + distance_var.toFixed(3) + " m", x.getPixelForValue(140), top+20);
                        // ctx.fillText("Volume         = " + volume_var.toFixed(3) + " m³", x.getPixelForValue(140), top+30);
                        // ctx.fillText("Temperature = " + temperature_var.toFixed(2) + " °C", x.getPixelForValue(140), top+40);
                        // ctx.fillText("Noise            = " + noise_var.toFixed(0) + " mV", x.getPixelForValue(140), top+50);
                        // ctx.fillText("Output          = " + mA_output_var.toFixed(2) + " mA", x.getPixelForValue(140), top+60);
                        // bit0 = status_var & 1;
                        // bit1 = status_var & 2;
                        // bit2 = status_var & 4;
                        // bit3 = status_var & 8;
                        // bit4 = status_var & 16;
                        // bit5 = status_var & 32;
                        // bit6 = status_var & 64;
                        // bit7 = status_var & 128;
                        // if(status_var == 0)
                        //     ctx.fillText("Status           = OK", x.getPixelForValue(140), top+80);
                        // else
                        // {
                        // if (bit4 == 16)
                        // {
                        //     if (bit5 == 32)
                        //         ctx.fillText("Status           = LOE fail high", x.getPixelForValue(140), top+80);
                        //     else if (bit6 == 64)
                        //         ctx.fillText("Status           = LOE fail low", x.getPixelForValue(140), top+80);
                        //     else
                        //         ctx.fillText("Status           = LOE fail", x.getPixelForValue(140), top+80);
                        // }
                        // else if (bit3 == 8)
                        //     ctx.fillText("Status           = LOE", x.getPixelForValue(140), top+80);
                        // else if (bit2 == 4)
                        //     ctx.fillText("Status           = Temp", x.getPixelForValue(140), top+80);
                        // else if (bit1 == 2)
                        //     ctx.fillText("Status           = Voltage", x.getPixelForValue(140), top+80);
                        // else if (bit7 == 128)
                        //     ctx.fillText("Status           = Alarm", x.getPixelForValue(140), top+80);
                        // else
                        //     ctx.fillText("Status           = " + status_var, x.getPixelForValue(140), top+80);
                        // }
                        ctx.restore();
                    }
                }

                const plugin = {          // For white background plot
                    id: 'custom_canvas_background_color',
                    beforeDraw: (chart) => {
                        const ctx = chart.canvas.getContext('2d');
                        ctx.save();
                        ctx.globalCompositeOperation = 'destination-over';
                        ctx.fillStyle = 'White';//'Transparent';
                        ctx.fillRect(0, 0, chart.width, chart.height);
                        ctx.restore();
                    }
                };
                
                var valtest = Math.round(0.5*200/compensated_var_m);//7.2);
                var rounding;

                // config block
                var config = {
                    type: 'line',
                    data: data,
                    plugins: [plugin, arbitraryLine], // Uses both plugins
                    options: {
                    maintainAspectRatio: false,                                      
                    scales: {                                 
                        x: {
                            //type: 'linear',
                            title: {
                                display: true,
                                text: p104_units,//'mtrs',
                            },
                            grid: {                
                            },
                            ticks: {
                                maxTicksLimit: xdata.length,
                                // For a category axis, the val is the index so the lookup via getLabelForValue is needed
                                callback: function(val, index) {
                                // Hide the label of every 14th dataset
                                rounding = Math.round(this.getLabelForValue(val)*100)/100;                // Rounded precision
                                if(index == 0)
                                  return (index) % valtest === 0 ? rounding.toFixed(1) : undefined;
                                else
                                  return (index + 1) % valtest === 0 ? rounding.toFixed(1) : undefined; // Shows rounded value in Xaxis aling with gridline,
                                },                                                                      // undefined don't shows gridlines
                                maxRotation: 0,   // Rotate the tick labels to show horizontally                     
                            }                     
                        },                                       
                        y: {
                            title: {
                                display: true,
                                text: 'mV',
                            },                        
                            max: 1000,
                            min:0,
                            ticks: {
                                stepSize: 100
                            },
                            beginAtZero: true
                        },               
                    },                
                    }                          
                };
                
                // render / init block
                var myChart = new Chart(
                    document.getElementById('myChart'),
                    config
                );
                </script>
            </tr>
            
            <!-- <tr>
                <td>
                    <button type="button" class="button" onclick="sendAT('ATrI'); button_press = 4">
                        Version
                    </button>
                </td>
                <td></td>
                 <td>
                    <button type="button" class="button" onclick="sendAT('AT+PT=1'); button_press = 5">
                        Enter PT
                    </button>
                </td>  
                  <td>
                    <button type="button" class="button" onclick="sendAT('GET ECHO'); button_press = 10">
                        GET ECHO
                    </button>
                </td>               
            </tr> -->          
    </table>
           <!-- end of the trace box-->
        </div>

        <table style="width:100%">
          <tr>              
              <td>
				<!-- need to revert back to the label as it gives better control -->
                <!-- <div class = "blocks" id='lvl_t'> </div>
                <div class = "blocks" id='dist_t'> </div>
                <div class = "blocks" id='sensor_status_t'> </div>           -->
                <textarea id="main-params-log-t" class="textarea3" rows="6" cols="8" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 40pt; font-weight: 500; width:430px; height:300px; background: rgb(228, 236, 237); resize:none; border: none;" readonly></textarea>
              </td>
              <td>
                <textarea id="data-log_t" class="textarea2" rows="4" cols="1" style="font-size: 22pt; font-weight: bold; width:380px; height:110px;" readonly>data-log_t</textarea>                
              </td>
          </tr>
        </table>
        <table style="width:100%;">
          <tr>
            <table style="width:100%;">
              <!-- <td style="position: center;">
                <button type="center" class="button button-style1" id="btn_mode2" visibility="hidden" onclick="button_press = 13; Normal_mode();">ADVANCED MODE</button>
                <script>
                  document.getElementById("btn_mode2").style.visibility="hidden";
                </script>
              </td> -->
              <td></td><td></td>
              <td></td><td></td>
              <td></td><td></td>  
              <td></td><td></td>
              <td></td>
              <td style="position: center;">
                <button type="button" class="button button-style1" id="btn_trace" onclick="button_press=10; trace_off();">TRACE OFF</button>
                <!-- <script>
                  document.getElementById("btn_trace").style.visibility="hidden";
                </script> -->
              </td>
              <!-- <td>
                <button type="button" class="button" id="btn_clear2" onclick="clearlog(); button_press = 9">
                  CLEAR
                </button>
              </td> -->
            </table>            
          </tr>                    
        </table>
      </div>
      </article>
    <!-- <div id="param_fields_main" style=" width:1080px; height:1080px; border-style: solid; border-width: 1px; border-radius: 10px;  border-color: rgba(243, 112, 33, 0.952);"> -->
      <article class="accordion-item" data-actab-group="0" data-actab-id="2">
        
        <h4 class="accordion-item__label">         
          <!-- <tr>
            <td><label id = "setting-message" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: bold; height:50px; display: inline-block;">Acquiring Bluetooth Parameters. Please wait...</label></td>
          </tr> -->
          <div id="bt_range" style='top:-40%;  left: -20%; width:68%; height:100%; border-style: solid; border-width: 3.5px; border-radius: 10px;  border-color: rgba(243, 112, 33, 0.952);' align="center">
            <tr>
              <td><label id = "bluetooth-parameters-label" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: bold; height:50px; display: inline-block;">Bluetooth Parameters</label></td>
            </tr>
            <table style="width:100%;">
              <tr>
                <!-- <td style="font-family: Segoe UI; font-size: 12pt; font-weight: bold; width:180px; height:80px; top:-10%; width:32%; left:30%;">
                  <h1>BT Range </h1>
                </td> -->
                <td><label id = "bt-range-label" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; width:80px; height:80px;">BT Range</label></td>
                <td style="position: center; width:45%;">
                  <div class="slidecontainer">
                    <input type="range" min="1" max="100" value="8" class="slider" style="position: center; height:100%;" id="myRange" onchange="testtest(value)" />
                  </div>
                </td>
                <td style="position: center; width:15%;">
                  <output style="font-family: Segoe UI; font-size: 42pt; font-weight: bold;" id="rangevalue1">3m</output>
                </td>                  
                </tr>
            </table>
            </div>

        </h4> <!-- IMPORTANT : donot remove this tag-->
        

        <div class="accordion-item__container">
          <!-- <div id="param_fields_main" style=" width:90%; height:90%; border-style: solid; border-width: 1px; border-radius: 10px;  border-color: rgba(243, 112, 33, 0.952);"> -->
          <div id="param_fields" style=" left: -40%; top: -20%; width:68%; height:80%; border-style: solid; border-width: 3.5px; border-radius: 10px;  border-color: rgba(243, 112, 33, 0.952);" align="center">
            <tr>
              <td><label id = "radar-parameters-label" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: bold; height:50px; display: inline-block;">RADAR Parameters</label></td>
            </tr>
            <table id = application_parameters">
            <tr>
              <td><label id = "p100" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; width:80px; height:80px;">Mode (P100)</label></td>
              <td><input type="text" id="p100-box" style="font-size: 24pt; font-weight: bold; width:180px; height:80px;" onkeydown="button_press = 20; wasEnter2(this);"></td>
              <td><button type="button" class="button" onclick="button_press = 20; param_check();">Update</button></td>
            </tr>
            <tr>
              <td><label id = "p104" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; width:80px; height:80px;">Measurement Units (P104)</label></td>
              <td><input type="text" id="p104-box" style="font-size: 24pt; font-weight: bold; width:180px; height:80px;" onkeydown="button_press = 21; wasEnter2(this);"></td>
              <td><button type="button" class="button" onclick="button_press = 21; param_check();">Update</button></td>
            </tr>
            <tr>
              <td><label id = "p105" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; width:80px; height:80px;">Empty Distance (P105)</label></td>
              <td><input type="text" id="p105-box" style="font-size: 24pt; font-weight: bold; width:180px; height:80px;" onkeydown="button_press = 22; wasEnter2(this)"></td>
              <td><button type="button" class="button" onclick="button_press = 22; param_check();">Update</button></td>
            </tr>
            <tr>
              <td><label id = "p106" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; width:80px; height:80px;">Span (P106)</label></td>
              <td><input type="text" id="p106-box" style="font-size: 24pt; font-weight: bold; width:180px; height:80px;" onkeydown="button_press = 23; wasEnter2(this);"></td>
              <td><button type="button" class="button" onclick="button_press = 23; param_check();">Update</button></td>
            </tr>
            <tr>
              <td><label id = "p808" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; width:80px; height:80px;">Fail Mode (P808)</label></td>
              <td><input type="text" id="p808-box" style="font-size: 24pt; font-weight: bold; width:180px; height:80px;" onkeydown="button_press = 24; wasEnter2(this);"></td>
              <td><button type="button" class="button" onclick="button_press = 24; param_check();">Update</button></td>
            </tr>
            <tr>
              <td><label id = "p605" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; width:80px; height:80px;">Volume Units (P605)</label></td>
              <td><input type="text" id="p605-box" style="font-size: 24pt; font-weight: bold; width:180px; height:80px;" onkeydown="button_press = 25; wasEnter2(this);"></td>
              <td><button type="button" class="button" onclick="button_press = 25; param_check();">Update</button></td>
            </tr>
            <tr>
              <td><label id = "p21" style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24pt; font-weight: 500; width:80px; height:80px;">P21</label></td>
              <td><input type="text" id="p21-box" style="font-size: 24pt; font-weight: bold; width:180px; height:80px;" onkeydown="button_press = 26; wasEnter2(this);"></td>
              <td><button type="button" class="button" onclick="button_press = 26; param_check();">Update</button></td>
            </tr>
          </table>
        </div>
        </div>
      </article>
      <!-- </div> -->
    
    </section>

    <div>
      <table>
        <tr>
          <td style=" text-align:center;font-size:24px;  background-color:rgb(54, 80, 114);;color:#2e2323;">
            <p style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; width: 874px; text-align:center; color:#ffffff; font-size:20pt;line-height:40px;">&copy; Pulsar Measurement 2022<br></p>
          </td>
        </tr>
      </table>
    </div>
  </section>
  <script  src="js/script-lr2.js"></script>
</body>
</html>
